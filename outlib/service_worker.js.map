{"version":3,"sources":["../lib/service_worker.js"],"names":["tabs","i","length","discarded","browser","discard","id","catch","e","console","error","log","message","discardTabs","remove","closeTabs","windowId","t","move","index","update","pinned","moveTabsToWindow","isIncognito","pinnedIndex","firstTab","shift","push","firstPinned","windows","create","tabId","incognito","w","oldTabId","get","oldTab","tabPinned","movedTabs","newTab","focused","createWindowWithTabs","window","customName","name","color","whitelistWindow","navigator","userAgent","search","whitelistTab","filteredWindow","Object","keys","windowsInfo","filter","key","includes","reduce","obj","left","top","width","height","type","newWindow","emptyTab","url","tabCreated","setWindowName","setWindowColor","createWindowWithSessionTabs","tab","then","active","tabActiveChanged","bind","focusOnTabAndWindow","getLocalStorage","colors","setLocalStorage","updateWindowHash","runtime","sendMessage","command","window_ids","names","populate","hash","hashcode","hashes","run","badge","query","result","count","action","setBadgeText","text","setBadgeBackgroundColor","toRemove","globalTabsActive","found","j","splice","updateTabCount","tabLimit","TAB_ID_NONE","currentWindow","tabCount","updateTabCountDebounce","tabAdded","sidebarAction","open","openSidebar","openInOwnTab","setPopup","popup","openPopup","popup_page","getURL","currentTab","previousTab","indexOf","highlight","openAsOwnTab","onClicked","removeListener","addListener","setPanel","panel","setupPopup","contextMenus","removeAll","title","contexts","parentId","info","menuItemId","onCreated","onUpdated","tabCountChanged","onRemoved","onReplaced","onDetached","onAttached","onActivated","onMoved","checkTabCreate","checkTabUpdate","checkTabRemove","checkTabDetached","checkTabAttached","checkTabMoved","onFocusChanged","windowFocus","windowCreated","windowRemoved","setTimeout","cleanupDebounce","setupListeners","storage","local","windowNames","windowColors","windowHashes","newHash","checkWindow","tabid","changeinfo","removeinfo","isWindowClosing","detachinfo","oldWindowId","attachinfo","newWindowId","moveinfo","hideWindows","permissions","contains","chrome","system","display","getInfo","displaylayouts","globalDisplayInfo","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","displaylayout","value","bounds","return","getAll","monitor","a","is_in_bounds","windowAge","Array","unshift","windowActive","activewindows","windowids","tocheck","Set","exists","to_refresh","parseInt","add","size","windowhash","has","delete","cleanUp","importScripts","onStartup","onSuspend","focusOnTabAndWindowDelayed","JSON","parse","stringify","focusOnWindowDelayed","focusOnWindow","debounce","lastActive","stringHashcode","string","code","charCodeAt","urls","sort","func","wait","immediate","timeout","context","args","arguments","later","apply","callNow","clearTimeout","object","C","B","commands","onCommand","onMessage","request","sender","sendResponse","window_id","tab_id","b","setInterval"],"mappings":"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","file":"service_worker.js","sourcesContent":["\"use strict\";\n\nimportScripts('../vendor/babel-polyfill.js');\nimportScripts('../vendor/browser-polyfill.min.js');\nimportScripts('./local.js');\n\nvar browser = browser || chrome;\nvar globalTabsActive = [];\nvar globalDisplayInfo = [];\n\nbrowser.runtime.onStartup.addListener(\n\tasync function () {\n\t\tconsole.log(\" ON STARTUP\");\n\t}\n);\n\nbrowser.runtime.onSuspend.addListener(\n\tasync function () {\n\t\tconsole.log(\" ON SUSPEND\");\n\t}\n);\n\nasync function discardTabs(tabs) {\n\tfor (var i = 0; i < tabs.length; i++) {\n\t\tif (!tabs[i].discarded) {\n\t\t\tbrowser.tabs.discard(tabs[i].id).catch(function (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\tconsole.log(e.message);\n\t\t\t});\n\t\t}\n\t}\n}\n\nasync function closeTabs(tabs) {\n\tfor (var i = 0; i < tabs.length; i++) {\n\t\tawait browser.tabs.remove(tabs[i].id);\n\t}\n}\n\nasync function moveTabsToWindow(windowId, tabs) {\n\tfor (var i = 0; i < tabs.length; i++) {\n\t\tvar t = tabs[i];\n\t\tawait browser.tabs.move(t.id, {windowId: windowId, index: -1});\n\t\tawait browser.tabs.update(t.id, {pinned: t.pinned});\n\t}\n}\n\nasync function createWindowWithTabs(tabs, isIncognito) {\n\n\tvar pinnedIndex = 0;\n\tvar firstTab = tabs.shift();\n\tvar t = [];\n\tfor (var i = 0; i < tabs.length; i++) {\n\t\tt.push(tabs[i].id);\n\t};\n\n\tvar firstPinned = firstTab.pinned;\n\tvar w = await browser.windows.create({ tabId: firstTab.id, incognito: !!isIncognito });\n\tif(firstPinned) {\n\t\tawait browser.tabs.update(w.tabs[0].id, { pinned: firstPinned });\n\t\tpinnedIndex++;\n\t}\n\n\tif (t.length > 0) {\n\t\tvar i = 0;\n\t\tfor (var oldTabId of t) {\n\t\t\ti++;\n\t\t\tvar oldTab = await browser.tabs.get(oldTabId);\n\t\t\tvar tabPinned = oldTab.pinned;\n\t\t\tvar movedTabs = [];\n\t\t\tif(!tabPinned) {\n\t\t\t\tmovedTabs = await browser.tabs.move(oldTabId, { windowId: w.id, index: -1 });\n\t\t\t}else{\n\t\t\t\tmovedTabs = await browser.tabs.move(oldTabId, { windowId: w.id, index: pinnedIndex++ });\n\t\t\t}\n\t\t\tif(movedTabs.length > 0) {\n\t\t\t\tvar newTab = movedTabs[0];\n\t\t\t\tif(tabPinned) {\n\t\t\t\t\tawait browser.tabs.update(newTab.id, { pinned: tabPinned });\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\tawait browser.windows.update(w.id, { focused: true });\n}\n\nasync function createWindowWithSessionTabs(window, tabId) {\n\n\tvar customName = false;\n\tif (window && window.name && window.customName) {\n\t\tcustomName = window.name;\n\t}\n\tvar color = \"default\";\n\tif (window && window.color) {\n\t\tcolor = window.color;\n\t}\n\n\tvar whitelistWindow = [\"left\", \"top\", \"width\", \"height\", \"incognito\", \"type\"];\n\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\n\t\twhitelistWindow = [\"left\", \"top\", \"width\", \"height\", \"incognito\", \"type\"];\n\t}\n\n\tvar whitelistTab = [\"url\", \"active\", \"selected\", \"pinned\", \"index\"];\n\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\n\t\twhitelistTab = [\"url\", \"active\", \"pinned\", \"index\"];\n\t}\n\n\tvar filteredWindow = Object.keys(window.windowsInfo)\n\t\t.filter(function (key) {\n\t\t\treturn whitelistWindow.includes(key);\n\t\t})\n\t\t.reduce(function (obj, key) {\n\t\t\tobj[key] = window.windowsInfo[key];\n\t\t\treturn obj;\n\t\t}, {});\n\n\tif (filteredWindow.left < 0 || filteredWindow.left > 800) filteredWindow.left = 0;\n\tif (filteredWindow.top < 0 || filteredWindow.top > 600) filteredWindow.top = 0;\n\tif (filteredWindow.width > 800) filteredWindow.width = 800;\n\tif (filteredWindow.height > 600) filteredWindow.height = 600;\n\n\tfilteredWindow.type = \"normal\";\n\n\t// console.log(\"filtered window\", filteredWindow);\n\n\tvar newWindow = await browser.windows.create(filteredWindow).catch(function (error) {\n\t\tconsole.error(error);\n\t\tconsole.log(error);\n\t\tconsole.log(error.message);\n\t});\n\n\tvar emptyTab = newWindow.tabs[0].id;\n\n\tfor (var i = 0; i < window.tabs.length; i++) {\n\t\tvar newTab = Object.keys(window.tabs[i])\n\t\t\t.filter(function (key) {\n\t\t\t\treturn whitelistTab.includes(key);\n\t\t\t})\n\t\t\t.reduce(function (obj, key) {\n\t\t\t\tobj[key] = window.tabs[i][key];\n\t\t\t\treturn obj;\n\t\t\t}, {});\n\n\t\tif (tabId != null && tabId != newTab.index) {\n\t\t\tcontinue;\n\t\t}\n\t\tnewTab.windowId = newWindow.id;\n\n\t\tif (navigator.userAgent.search(\"Firefox\") > -1) {\n\t\t\tif (!!newTab.url && newTab.url.search(\"about:\") > -1) {\n\t\t\t\tconsole.log(\"filtered by about: url\", newTab.url);\n\t\t\t\tnewTab.url = \"\";\n\t\t\t}\n\t\t}\n\t\ttry {\n\t\t\tvar tabCreated = await browser.tabs.create(newTab).catch(function (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t\tconsole.log(error);\n\t\t\t\tconsole.log(error.message);\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconsole.log(\"couldn't restore tab\");\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\tawait browser.tabs.remove(emptyTab).catch(function (error) {\n\t\tconsole.error(error);\n\t\tconsole.log(error);\n\t\tconsole.log(error.message);\n\t});\n\n\tif (customName) {\n\t\tconsole.log(\"setting name\");\n\t\tsetWindowName(newWindow.id, customName);\n\t}\n\n\tif (color != \"default\") {\n\t\tconsole.log(\"setting color\");\n\t\tsetWindowColor(newWindow.id, color);\n\t}\n\n\tawait browser.windows.update(newWindow.id, {focused: true});\n}\n\nfunction focusOnTabAndWindowDelayed(tab) {\n\tvar tab = JSON.parse(JSON.stringify(tab));\n\tsetTimeout(focusOnTabAndWindow.bind(this, tab), 125);\n}\n\nasync function focusOnTabAndWindow(tab) {\n\tvar windowId = tab.windowId;\n\tvar tabId;\n\tif (!!tab.tabId) {\n\t\ttabId = tab.tabId;\n\t} else {\n\t\ttabId = tab.id;\n\t}\n\n\tbrowser.windows.update(windowId, { focused: true }).then(function(tabId, windowId) {\n\t\tbrowser.tabs.update(tabId, { active: true }).then(function(tabId, windowId) {\n\t\t\ttabActiveChanged({ tabId: tabId, windowId: windowId });\n\t\t}.bind(this, tabId, windowId));\n\t}.bind(this, tabId, windowId));\n}\n\nfunction focusOnWindowDelayed(windowId) {\n\tsetTimeout(focusOnWindow.bind(this, windowId), 125);\n}\n\nasync function setWindowColor(windowId, color) {\n\tvar colors = await getLocalStorage(\"windowColors\", {});\n\tif (typeof colors !== 'object') colors = {};\n\tcolors[windowId] = color;\n\tawait setLocalStorage(\"windowColors\", colors);\n\tawait updateWindowHash(windowId);\n\tbrowser.runtime.sendMessage({\n\t\tcommand: \"refresh_windows\",\n\t\twindow_ids: [windowId]\n\t});\n}\n\nasync function setWindowName(windowId, name) {\n\tvar names = await getLocalStorage(\"windowNames\", {});\n\tif (typeof names !== 'object') names = {};\n\tnames[windowId] = name;\n\tawait setLocalStorage(\"windowNames\", names);\n\tawait updateWindowHash(windowId);\n\tbrowser.runtime.sendMessage({\n\t\tcommand: \"refresh_windows\",\n\t\twindow_ids: [windowId]\n\t});\n}\n\nasync function updateWindowHash(windowId) {\n\tvar window = await browser.windows.get(windowId, { populate: true });\n\tvar hash = hashcode(window);\n\tvar hashes = await getLocalStorage(\"windowHashes\", {});\n\thashes[windowId] = hash;\n\tawait setLocalStorage(\"windowHashes\", hashes);\n}\n\nfunction focusOnWindow(windowId) {\n\tbrowser.windows.update(windowId, { focused: true });\n}\n\nasync function updateTabCount() {\n\tvar run = true;\n\n\tvar badge = await getLocalStorage(\"badge\", true);\n\tif (!badge) run = false;\n\n\tif (run) {\n\t\tvar result = await browser.tabs.query({});\n\t\tvar count = 0;\n\t\tif (!!result && !!result.length) {\n\t\t\tcount = result.length;\n\t\t}\n\t\tawait browser.action.setBadgeText({ text: count + \"\" });\n\t\tawait browser.action.setBadgeBackgroundColor({ color: \"purple\" });\n\t\tvar toRemove = [];\n\t\tif (!!globalTabsActive) {\n\t\t\tfor (var i = 0; i < globalTabsActive.length; i++) {\n\t\t\t\tvar t = globalTabsActive[i];\n\t\t\t\tvar found = false;\n\t\t\t\tif (!!result && !!result.length) {\n\t\t\t\t\tfor (var j = 0; j < result.length; j++) {\n\t\t\t\t\t\tif (result[j].id == t.tabId) found = true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (!found) toRemove.push(i);\n\t\t\t};\n\t\t}\n\t\t// console.log(\"to remove\", toRemove);\n\t\tfor (var i = toRemove.length - 1; i >= 0; i--) {\n\t\t\t// console.log(\"removing\", toRemove[i]);\n\t\t\tif (!!globalTabsActive && globalTabsActive.length > 0) {\n\t\t\t\tif (!!globalTabsActive[toRemove[i]]) globalTabsActive.splice(toRemove[i], 1);\n\t\t\t}\n\t\t};\n\t} else {\n\t\tawait browser.action.setBadgeText({ text: \"\" });\n\t}\n}\n\nvar updateTabCountDebounce = debounce(updateTabCount, 250);\nvar cleanupDebounce = debounce(cleanUp, 500);\n\nfunction tabCountChanged() {\n\tupdateTabCountDebounce();\n}\n\nasync function tabAdded(tab) {\n\tvar tabLimit = await getLocalStorage(\"tabLimit\", 0);\n\tif (tabLimit > 0) {\n\t\tif (tab.id != browser.tabs.TAB_ID_NONE) {\n\t\t\tvar tabCount = await browser.tabs.query({ currentWindow: true });\n\t\t\tif(tabCount.length > tabLimit) {\n\t\t\t\tawait createWindowWithTabs([tab], tab.incognito);\n\t\t\t}\n\t\t}\n\t}\n\tupdateTabCountDebounce();\n}\n\n\n\nfunction tabActiveChanged(tab) {\n\tif (!!tab && !!tab.tabId) {\n\t\tif (!globalTabsActive) globalTabsActive = [];\n\t\tif (!!globalTabsActive && globalTabsActive.length > 0) {\n\t\t\tvar lastActive = globalTabsActive[globalTabsActive.length - 1];\n\t\t\tif (!!lastActive && lastActive.tabId == tab.tabId && lastActive.windowId == tab.windowId) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\twhile (globalTabsActive.length > 20) {\n\t\t\tglobalTabsActive.shift();\n\t\t}\n\t\tfor (var i = globalTabsActive.length - 1; i >= 0; i--) {\n\t\t\tif (globalTabsActive[i].tabId == tab.tabId) {\n\t\t\t\tglobalTabsActive.splice(i, 1);\n\t\t\t}\n\t\t};\n\t\tglobalTabsActive.push(tab);\n\t}\n\tupdateTabCountDebounce();\n}\n\nasync function openSidebar() {\n\tawait browser.sidebarAction.open();\n}\n\nasync function openPopup() {\n\n\tvar openInOwnTab = await getLocalStorage(\"openInOwnTab\", false);\n\tif (openInOwnTab) {\n\t\tawait browser.action.setPopup({ popup: \"popup.html?popup=true\" });\n\t\tawait browser.action.openPopup();\n\t\tawait browser.action.setPopup({ popup: \"\" });\n\t}else{\n\t\tawait browser.action.openPopup();\n\t}\n}\n\nasync function openAsOwnTab() {\n\tvar popup_page = browser.runtime.getURL(\"popup.html\");\n\tvar tabs = await browser.tabs.query({});\n\n\tvar currentTab;\n\tvar previousTab;\n\tif (!!globalTabsActive && globalTabsActive.length > 1) {\n\t\tcurrentTab = globalTabsActive[globalTabsActive.length - 1];\n\t\tpreviousTab = globalTabsActive[globalTabsActive.length - 2];\n\t}\n\n\tfor (var i = 0; i < tabs.length; i++) {\n\t\tvar tab = tabs[i];\n\t\tif (tab.url.indexOf(\"popup.html\") > -1 && tab.url.indexOf(popup_page) > -1) {\n\t\t\tif(currentTab && currentTab.tabId && tab.id == currentTab.tabId && previousTab && previousTab.tabId) {\n\t\t\t\treturn focusOnTabAndWindow(previousTab);\n\t\t\t}else{\n\t\t\t\treturn browser.windows.update(tab.windowId, { focused: true }).then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tbrowser.tabs.highlight({ windowId: tab.windowId, tabs: tab.index });\n\t\t\t\t\t}.bind(this)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn browser.tabs.create({ url: \"popup.html\" });\n}\n\nasync function setupPopup() {\n\n\tvar openInOwnTab = await getLocalStorage(\"openInOwnTab\", false);\n\n\tawait browser.action.onClicked.removeListener(openAsOwnTab);\n\tif (openInOwnTab) {\n\t\tawait browser.action.setPopup({ popup: \"\" });\n\t\tawait browser.action.onClicked.addListener(openAsOwnTab);\n\t} else {\n\t\tawait browser.action.setPopup({ popup: \"popup.html?popup=true\" });\n\t}\n\tif (browser.sidebarAction) {\n\t\tbrowser.sidebarAction.setPanel({ panel: \"popup.html?panel=true\" });\n\t}\n}\n\nasync function setupListeners() {\n\n\tawait browser.contextMenus.removeAll();\n\tbrowser.contextMenus.create({\n\t\tid: \"open_in_own_tab\",\n\t\ttitle: \"üìî Open in own tab\",\n\t\tcontexts: [\"action\"]\n\t});\n\n\tif(!!browser.action.openPopup) {\n\t\tbrowser.contextMenus.create({\n\t\t\tid: \"open_popup\",\n\t\t\ttitle: \"üìë Open popup\",\n\t\t\tcontexts: [\"action\"]\n\t\t});\n\t}\n\n\tif(!!browser.sidebarAction) {\n\t\tbrowser.contextMenus.create({\n\t\t\tid: \"open_sidebar\",\n\t\t\ttitle: \"üóÇ Open sidebar\",\n\t\t\tcontexts: [\"action\"]\n\t\t});\n\t}\n\n\tbrowser.contextMenus.create({\n\t\tid: \"sep1\",\n\t\ttype: \"separator\",\n\t\tcontexts: [\"action\"]\n\t});\n\n\tbrowser.contextMenus.create({\n\t\ttitle: \"üòç Support this extension\",\n\t\tid: \"support_menu\",\n\t\t\"contexts\": [\"action\"]\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"review\",\n\t\ttitle: \"‚≠ê Leave a review\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"support_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"donate\",\n\t\ttitle: \"‚òï Donate to keep Extensions Alive\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"support_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"patron\",\n\t\ttitle: \"üí∞ Become a Patron\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"support_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"twitter\",\n\t\ttitle: \"üê¶ Follow on Twitter\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"support_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\ttitle: \"ü§î Issues and Suggestions\",\n\t\tid: \"code_menu\",\n\t\t\"contexts\": [\"action\"]\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"changelog\",\n\t\ttitle: \"üÜï View recent changes\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"code_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"options\",\n\t\ttitle: \"‚öô Edit Options\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"code_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"source\",\n\t\ttitle: \"üíª View source code\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"code_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"report\",\n\t\ttitle: \"ü§î Report an issue\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"code_menu\"\n\t});\n\n\tbrowser.contextMenus.create({\n\t\tid: \"send\",\n\t\ttitle: \"üí° Send a suggestion\",\n\t\t\"contexts\": [\"action\"],\n\t\tparentId: \"code_menu\"\n\t});\n\n\tbrowser.contextMenus.onClicked.addListener(\n\t\tfunction (info, tab) {\n\t\t\tif (info.menuItemId == \"open_in_own_tab\") openAsOwnTab();\n\t\t\tif (info.menuItemId == \"open_popup\") openPopup();\n\t\t\tif (info.menuItemId == \"open_sidebar\") openSidebar();\n\n\t\t\tif (info.menuItemId == \"donate\") browser.tabs.create({url: 'https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=67TZLSEGYQFFW'});\n\t\t\tif (info.menuItemId == \"patron\") browser.tabs.create({url: 'https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=67TZLSEGYQFFW'});\n\t\t\tif (info.menuItemId == \"changelog\") browser.tabs.create({url: 'changelog.html'});\n\t\t\tif (info.menuItemId == \"options\") browser.tabs.create({url: 'options.html'});\n\t\t\tif (info.menuItemId == \"report\") browser.tabs.create({url: 'https://github.com/stefanXO/Tab-Manager-Plus/issues'});\n\n\t\t\tif (info.menuItemId == \"source\") browser.tabs.create({url: 'https://github.com/stefanXO/Tab-Manager-Plus'});\n\n\t\t\tif (info.menuItemId == \"twitter\") browser.tabs.create({url: 'https://www.twitter.com/mastef'});\n\n\t\t\tif (info.menuItemId == \"send\") {\n\t\t\t\tbrowser.tabs.create({url: 'https://github.com/stefanXO/Tab-Manager-Plus/issues'});\n\t\t\t\tbrowser.tabs.create({url: 'mailto:markus+tmp@stefanxo.com'});\n\t\t\t}\n\n\t\t\tif (info.menuItemId == \"review\") {\n\t\t\t\tif (navigator.userAgent.search(\"Firefox\") > -1) {\n\t\t\t\t\tbrowser.tabs.create({url: 'https://addons.mozilla.org/en-US/firefox/addon/tab-manager-plus-for-firefox/'});\n\t\t\t\t} else {\n\t\t\t\t\tbrowser.tabs.create({url: 'https://chrome.google.com/webstore/detail/tab-manager-plus-for-chro/cnkdjjdmfiffagllbiiilooaoofcoeff'});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t);\n\n\tsetupPopup();\n\n\tbrowser.tabs.onCreated.removeListener(tabAdded);\n\tbrowser.tabs.onUpdated.removeListener(tabCountChanged);\n\tbrowser.tabs.onRemoved.removeListener(tabCountChanged);\n\tbrowser.tabs.onReplaced.removeListener(tabCountChanged);\n\tbrowser.tabs.onDetached.removeListener(tabCountChanged);\n\tbrowser.tabs.onAttached.removeListener(tabCountChanged);\n\tbrowser.tabs.onActivated.removeListener(tabActiveChanged);\n\tbrowser.tabs.onMoved.removeListener(tabCountChanged);\n\n\tbrowser.tabs.onCreated.removeListener(checkTabCreate);\n\tbrowser.tabs.onUpdated.removeListener(checkTabUpdate);\n\tbrowser.tabs.onRemoved.removeListener(checkTabRemove);\n\tbrowser.tabs.onDetached.removeListener(checkTabDetached);\n\tbrowser.tabs.onAttached.removeListener(checkTabAttached);\n\tbrowser.tabs.onMoved.removeListener(checkTabMoved);\n\n\tbrowser.windows.onFocusChanged.removeListener(windowFocus);\n\tbrowser.windows.onCreated.removeListener(windowCreated);\n\tbrowser.windows.onRemoved.removeListener(windowRemoved);\n\n\tbrowser.tabs.onCreated.addListener(tabAdded);\n\tbrowser.tabs.onUpdated.addListener(tabCountChanged);\n\tbrowser.tabs.onRemoved.addListener(tabCountChanged);\n\tbrowser.tabs.onReplaced.addListener(tabCountChanged);\n\tbrowser.tabs.onDetached.addListener(tabCountChanged);\n\tbrowser.tabs.onAttached.addListener(tabCountChanged);\n\tbrowser.tabs.onActivated.addListener(tabActiveChanged);\n\tbrowser.tabs.onMoved.addListener(tabCountChanged);\n\n\tbrowser.tabs.onCreated.addListener(checkTabCreate); // 1, tab\n\tbrowser.tabs.onUpdated.addListener(checkTabUpdate); // 3, tabid, changeinfo, tab\n\tbrowser.tabs.onRemoved.addListener(checkTabRemove); // 2, tabid, removeinfo\n\tbrowser.tabs.onDetached.addListener(checkTabDetached); // 2, tabid, detachinfo\n\tbrowser.tabs.onAttached.addListener(checkTabAttached); // 2, tabid, attachinfo\n\tbrowser.tabs.onMoved.addListener(checkTabMoved); // 2, tabid, moveinfo\n\n\tbrowser.windows.onFocusChanged.addListener(windowFocus);\n\tbrowser.windows.onCreated.addListener(windowCreated);\n\tbrowser.windows.onRemoved.addListener(windowRemoved);\n\tupdateTabCountDebounce();\n\n\tsetTimeout(cleanupDebounce, 2500);\n}\n\nfunction stringHashcode(string) {\n\tvar hash = 0;\n\tfor (var i = 0; i < string.length; i++) {\n\t\tvar code = string.charCodeAt(i);\n\t\thash = ((hash << 5) - hash) + code;\n\t\thash = hash & hash; // Convert to 32bit integer\n\t}\n\treturn hash;\n}\n\nfunction hashcode(window) {\n\tvar urls = [];\n\tfor (var i = 0; i < window.tabs.length; i++) {\n\t\tif (!window.tabs[i].url) continue;\n\t\turls.push(window.tabs[i].url);\n\t}\n\turls.sort();\n\n\tvar hash = 0;\n\tfor (var i = 0; i < urls.length; i++) {\n\t\tvar code = stringHashcode(urls[i]);\n\t\thash = ((hash << 5) - hash) + code;\n\t\thash = hash & hash; // Convert to 32bit integer\n\t}\n\treturn hash;\n}\n\nasync function checkWindow(windowId) {\n\tif (!windowId) return;\n\n\tvar storage = await browser.storage.local.get(['windowNames', 'windowColors', 'windowHashes']);\n\n\tvar names = storage.windowNames || {};\n\tvar colors = storage.windowColors || {};\n\tvar hashes = storage.windowHashes || {};\n\n\tif (!names[windowId] && !colors[windowId]) return;\n\n\ttry {\n\t\tvar window = await browser.windows.get(windowId, {populate: true});\n\n\t\tvar newHash = hashcode(window);\n\t\thashes[windowId] = newHash;\n\t\tawait setLocalStorage('windowHashes', hashes);\n\t} catch (e) {\n\t\tconsole.log(e);\n\t}\n}\n\nasync function checkTabCreate(tab) {\n\tcheckWindow(tab.windowId);\n}\n\nasync function checkTabUpdate(tabid, changeinfo, tab) {\n\tcheckWindow(tab.windowId);\n}\n\nasync function checkTabRemove(tabid, removeinfo) {\n\tif (removeinfo.isWindowClosing) return;\n\tcheckWindow(removeinfo.windowId);\n}\n\nasync function checkTabDetached(tabid, detachinfo) {\n\tcheckWindow(detachinfo.oldWindowId);\n}\n\nasync function checkTabAttached(tabid, attachinfo) {\n\tcheckWindow(attachinfo.newWindowId);\n}\n\nasync function checkTabMoved(tabid, moveinfo) {\n\tcheckWindow(moveinfo.windowId);\n}\n\n// Returns a function, that, as long as it continues to be invoked, will not\n// be triggered. The function will be called after it stops being called for\n// N milliseconds. If `immediate` is passed, trigger the function on the\n// leading edge, instead of the trailing.\nfunction debounce(func, wait, immediate) {\n\tvar timeout;\n\treturn function () {\n\t\tvar context = this,args = arguments;\n\t\tvar later = function later() {\n\t\t\ttimeout = null;\n\t\t\tif (!immediate) func.apply(context, args);\n\t\t};\n\t\tvar callNow = immediate && !timeout;\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(later, wait);\n\t\tif (callNow) func.apply(context, args);\n\t};\n};\n\nfunction windowFocus(windowId) {\n\ttry {\n\t\tif (!!windowId) {\n\t\t\twindowActive(windowId);\n\t\t\t// console.log(\"onFocused\", windowId);\n\t\t\thideWindows(windowId);\n\t\t}\n\t} catch (e) {\n\n\t}\n}\nfunction windowCreated(window) {\n\ttry {\n\t\tif (!!window && !!window.id) {\n\t\t\twindowActive(window.id);\n\t\t}\n\t} catch (e) {\n\n\t}\n\t// console.log(\"onCreated \" + window.id, window);\n\tsetTimeout(cleanupDebounce, 250);\n}\nfunction windowRemoved(windowId) {\n\ttry {\n\t\tif (!!windowId) {\n\t\t\twindowActive(windowId);\n\t\t}\n\t} catch (e) {\n\n\t}\n\t// console.log(\"onRemoved\", windowId);\n}\n\nasync function hideWindows(windowId) {\n\tif (navigator.userAgent.search(\"Firefox\") > -1) {\n\t\treturn;\n\t}\n\n\tif (!windowId || windowId < 0) {\n\t\treturn;\n\t} else {\n\t\tvar hideWindows = await getLocalStorage(\"hideWindows\", false);\n\t\tif (!hideWindows) return;\n\n\t\tvar result = await browser.permissions.contains({ permissions: ['system.display'] });\n\t\tif (result) {\n\t\t\t// The extension has the permissions.\n\t\t\tchrome.system.display.getInfo(async function (windowId, displaylayouts) {\n\t\t\t\tglobalDisplayInfo = [];\n\t\t\t\tvar _iteratorNormalCompletion = true;\n\t\t\t\tvar _didIteratorError = false;\n\t\t\t\tvar _iteratorError = undefined;\n\t\t\t\ttry {\n\t\t\t\t\tfor (var _iterator = displaylayouts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {var displaylayout = _step.value;\n\t\t\t\t\t\tglobalDisplayInfo.push(displaylayout.bounds);\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\t_didIteratorError = true;\n\t\t\t\t\t_iteratorError = err;\n\t\t\t\t} finally {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t\t\t_iterator.return();\n\t\t\t\t\t\t}\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar windows = await browser.windows.getAll({ populate: true });\n\t\t\t\tvar monitor = -1;\n\t\t\t\tfor (var i = windows.length - 1; i >= 0; i--) {\n\t\t\t\t\tif (windows[i].id == windowId) {\n\t\t\t\t\t\tfor (var a in globalDisplayInfo) {\n\t\t\t\t\t\t\tvar result = is_in_bounds(windows[i], globalDisplayInfo[a]);\n\t\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\t\tmonitor = a;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfor (var i = windows.length - 1; i >= 0; i--) {\n\t\t\t\t\tif (windows[i].id != windowId) {\n\t\t\t\t\t\tif (is_in_bounds(windows[i], globalDisplayInfo[monitor])) {\n\t\t\t\t\t\t\tawait browser.windows.update(windows[i].id, { \"state\": \"minimized\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}.bind(null, windowId));\n\t\t}\n\t}\n}\n\nfunction is_in_bounds(object, bounds) {\n\tvar C = object,B = bounds;\n\tif (C.left >= B.left && C.left <= B.left + B.width) {\n\t\tif (C.top >= B.top && C.top <= B.top + B.height) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nasync function windowActive(windowId) {\n\tif (windowId < 0) return;\n\n\tvar windows = [];\n\tvar windowAge = await getLocalStorage(\"windowAge\", []);\n\tif (windowAge instanceof Array) windows = windowAge;\n\n\tif (windows.indexOf(windowId) > -1) windows.splice(windows.indexOf(windowId), 1);\n\twindows.unshift(windowId);\n\tawait setLocalStorage(\"windowAge\", windows);\n\n\t// browser.windows.getLastFocused({ populate: true }, function (w) {\n\t// \tfor (var i = 0; i < w.tabs.length; i++) {\n\t// \t\tvar tab = w.tabs[i];\n\t// \t\tif (tab.active == true) {\n\t// \t\t\t// console.log(\"get last focused\", tab.id);\n\t// \t\t\t// tabActiveChanged({\n\t// \t\t\t// \ttabId: tab.id,\n\t// \t\t\t// \twindowId: tab.windowId\n\t// \t\t\t// });\n\t// \t\t}\n\t// \t};\n\t// });\n\t// console.log(windows);\n}\n\nbrowser.commands.onCommand.addListener(function (command) {\n\tif (command == \"switch_to_previous_active_tab\") {\n\t\tif (!!globalTabsActive && globalTabsActive.length > 1) {\n\t\t\tfocusOnTabAndWindow(globalTabsActive[globalTabsActive.length - 2]);\n\t\t}\n\t}\n});\n\nbrowser.runtime.onMessage.addListener(function(request, sender, sendResponse) {\n\tswitch (request.command) {\n\t\tcase \"reload_popup_controls\":\n\t\t\tsetupPopup();\n\t\t\tbreak;\n\t\tcase \"update_tab_count\":\n\t\t\tupdateTabCount();\n\t\t\tbreak;\n\t\tcase \"discard_tabs\":\n\t\t\tdiscardTabs(request.tabs);\n\t\t\tbreak;\n\t\tcase \"move_tabs_to_window\":\n\t\t\tmoveTabsToWindow(request.window_id, request.tabs);\n\t\t\tbreak;\n\t\tcase \"focus_on_tab_and_window\":\n\t\t\tfocusOnTabAndWindow(request.tab);\n\t\t\tbreak;\n\t\tcase \"focus_on_tab_and_window_delayed\":\n\t\t\tfocusOnTabAndWindowDelayed(request.tab);\n\t\t\tbreak;\n\t\tcase \"focus_on_window\":\n\t\t\tfocusOnWindow(request.window_id);\n\t\t\tbreak;\n\t\tcase \"focus_on_window_delayed\":\n\t\t\tfocusOnWindowDelayed(request.window_id);\n\t\t\tbreak;\n\t\tcase \"set_window_color\":\n\t\t\tsetWindowColor(request.window_id, request.color);\n\t\t\tbreak;\n\t\tcase \"set_window_name\":\n\t\t\tsetWindowName(request.window_id, request.name);\n\t\t\tbreak;\n\t\tcase \"create_window_with_tabs\":\n\t\t\tcreateWindowWithTabs(request.tabs);\n\t\t\tbreak;\n\t\tcase \"create_window_with_session_tabs\":\n\t\t\tcreateWindowWithSessionTabs(request.window, request.tab_id);\n\t\t\tbreak;\n\t\tcase \"close_tabs\":\n\t\t\tcloseTabs(request.tabs);\n\t\t\tbreak;\n\t}\n});\n\n(async function () {\n\tvar windows = await browser.windows.getAll({ populate: true });\n\tawait setLocalStorage(\"windowAge\", []);\n\tif (!!windows && windows.length > 0) {\n\t\twindows.sort(function (a, b) {\n\t\t\tif (a.id < b.id) return 1;\n\t\t\tif (a.id > b.id) return -1;\n\t\t\treturn 0;\n\t\t});\n\t\tfor (var i = 0; i < windows.length; i++) {\n\t\t\tif (!!windows[i].id) await windowActive(windows[i].id);\n\t\t};\n\t}\n})();\n\nasync function cleanUp() {\n\tvar activewindows = await browser.windows.getAll({populate: true});\n\tvar windowids = [];\n\tfor (var w of activewindows) {\n\t\twindowids.push(w.id);\n\t}\n\t// console.log(\"window ids...\", windowids);\n\n\tvar windows = await getLocalStorage(\"windowAge\", []);\n\tif (!(windows instanceof Array)) windows = [];\n\n\t// console.log(\"before\", JSON.parse(JSON.stringify(windows)));\n\tfor (var i = windows.length - 1; i >= 0; i--) {\n\t\tif (windowids.indexOf(windows[i]) < 0) {\n\t\t\t// console.log(\"did not find\", windows[i], i);\n\t\t\twindows.splice(i, 1);\n\t\t}\n\t};\n\t// console.log(\"after\", JSON.parse(JSON.stringify(windows)));\n\tawait setLocalStorage(\"windowAge\", windows);\n\n\tvar names = await getLocalStorage(\"windowNames\", {});\n\tvar colors = await getLocalStorage(\"windowColors\", {});\n\tvar tocheck = new Set();\n\tvar exists = new Set();\n\tvar to_refresh = [];\n\n\t// console.log(\"before\", JSON.parse(JSON.stringify(names)));\n\tfor (var id in names) {\n\t\tif (windowids.indexOf(parseInt(id)) < 0) {\n\t\t\t// console.log(\"did not find\", id);\n\t\t\ttocheck.add(id);\n\t\t} else {\n\t\t\texists.add(id);\n\t\t}\n\t}\n\n\tfor (var id in colors) {\n\t\tif (windowids.indexOf(parseInt(id)) < 0) {\n\t\t\t// console.log(\"did not find\", id);\n\t\t\ttocheck.add(id);\n\t\t} else {\n\t\t\texists.add(id);\n\t\t}\n\t}\n\n\tif (tocheck.size > 0) {\n\t\tvar hashes = await getLocalStorage(\"windowHashes\", {});\n\t\tconsole.log(hashes);\n\t\tconsole.log(names);\n\t\tconsole.log(colors);\n\n\t\t// delete hashes with empty values\n\t\tfor (var id in hashes) if (!hashes[id]) delete hashes[id];\n\t\tfor (var id in colors) if (!colors[id]) delete colors[id];\n\n\t\tvar found = false;\n\n\t\tfor (var w of activewindows) {\n\t\t\tvar windowhash = hashcode(w);\n\t\t\tfor (var id in hashes) {\n\t\t\t\tif (!tocheck.has(id)) continue;\n\t\t\t\tif (exists.has(id)) continue;\n\t\t\t\tif (w.id == id) break;\n\t\t\t\tif (hashes[id] == windowhash) {\n\t\t\t\t\tconsole.log(\"found by hash, old id \" + id + \" new id \" + w.id);\n\t\t\t\t\tto_refresh.push(w.id);\n\t\t\t\t\tif (!!names[id]) {\n\t\t\t\t\t\tnames[w.id] = names[id];\n\t\t\t\t\t\tdelete names[id];\n\t\t\t\t\t}\n\t\t\t\t\tif (!!colors[id]) {\n\t\t\t\t\t\tcolors[w.id] = colors[id];\n\t\t\t\t\t\tdelete colors[id];\n\t\t\t\t\t}\n\t\t\t\t\thashes[w.id] = names[id];\n\t\t\t\t\tdelete hashes[id];\n\t\t\t\t\tfound = true;\n\t\t\t\t\ttocheck.delete(id);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var id in tocheck) {\n\t\t\tconsole.log(\"did not find by hash\", id);\n\t\t\t//delete colors[id];\n\t\t\t//delete names[id];\n\t\t\t//delete hashes[id];\n\t\t}\n\n\t\tif (found) {\n\t\t\tawait setLocalStorage(\"windowNames\", names);\n\t\t\tawait setLocalStorage(\"windowColors\", colors);\n\t\t\tawait setLocalStorage(\"windowHashes\", hashes);\n\t\t\tbrowser.runtime.sendMessage({\n\t\t\t\tcommand: \"refresh_windows\",\n\t\t\t\twindow_ids: to_refresh\n\t\t\t});\n\t\t}\n\n\t\tconsole.log(tocheck)\n\t\tconsole.log(exists)\n\t\tconsole.log(hashes);\n\t\tconsole.log(names);\n\t\tconsole.log(colors);\n\t}\n}\n\nsetInterval(setupListeners, 300000);\n\nsetupListeners();\n\n"]}